<!--
  ~ Copyright (c) 2019 University of Stuttgart.
  ~
  ~ See the NOTICE file(s) distributed with this work for additional
  ~ information regarding copyright ownership.
  ~
  ~ This program and the accompanying materials are made available under the
  ~ terms of the Eclipse Public License 2.0 which is available at
  ~ http://www.eclipse.org/legal/epl-2.0, or the Apache Software License 2.0
  ~ which is available at https://www.apache.org/licenses/LICENSE-2.0.
  ~
  ~ SPDX-License-Identifier: EPL-2.0 OR Apache-2.0
  -->

<p-dialog styleClass="modal-scrollable" (onHide)="closeModal()" [contentStyle]="{'overflow': 'auto', 'height': 'auto'}" [(visible)]="visible"
          [draggable]="false" [resizable]="false" modal="true">
    <p-header>
        Placement of Application Components
    </p-header>
    <p>
        This application has open requirements and can't be instantiated in its current state.<br>
        If you have running instances with capabilities that satisfy the open requirements of this application,<br>
        you can initiate a placement operation.
    </p>

    <div *ngIf="placementInProgress">
        <div class="p-grid p-justify-center p-align-center">
            <div class="p-col">
                <p-progressBar strokeWidth="2" mode="indeterminate"></p-progressBar>
                <h4>Placement Candidate Search in progress...</h4>
            </div>
        </div>
    </div>

    <div *ngIf="placementCandidateExists">
        <h4 class="first">The options are sorted by recommendation of the Placement Algorithm.<br>Selecting the first item in each dropdown represents the best choice, selecting alternatives is possible if they exist.</h4>
        <h4 class="first">{{applicationName}}</h4>
        <div *ngFor="let mapEntry of mapOfPossiblePlacements | keyvalue; let i = index">
            <div style="display: flex; justify-content: center;">
                <div style="width: 90%;">

                    <div style="display: flex; justify-content: space-around;">
                        <div style="width: 30%"><b>{{ mapEntry.key }}:</b></div>
                        <div style="width: 70%">
                            <select [(ngModel)]="selectedPlacement[i]" (change)="onChangeSelection($event.target.value)">
                                <option [value]="option | json" *ngFor="let option of mapEntry.value">
                                <b>Instance ID:</b> {{ option.cpbNode.instance_idof_osnode }} |
                                <b>NodeTemplate ID:</b> {{option.cpbNode.os_node}}
                                </option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div style="width=90%; margin-top: 1em;" *ngIf="waitingForCompletion">
        <div class="p-grid p-justify-center p-align-center">
            <div class="p-col">
                <p-progressBar strokeWidth="2" mode="indeterminate"></p-progressBar>
                <h4>Placement Candidate Completion in progress...</h4>
            </div>
        </div>
    </div>

    <div style="width=90%;" *ngIf="csarGotCompletedSuccessfully">
        <br><p>The ServiceTemplate containing the placement candidate you chose was completed successfully. <br>Find the old and new servicetemplate</p>
        <a target="_blank" href="{{completedCsarUrl}}">here.</a>
        <br>
        <p>Download the new CSAR</p>
        <a target="_blank" href="{{csarDownloadUrl}}">here.</a>
    </div>

    <p-footer>
        <button *ngIf="placementCandidateIsSet" type="button" pButton (click)="createDeployableCSARfromCandidate()" label="Create Deployable CSAR from Candidate">
        </button>
        <button type="button" pButton (click)="runPlacementOperation()" label="Run Placement Operation">
        </button>
        <button type="button" pButton (click)="closeModal()" label="Close"></button>
    </p-footer>
</p-dialog>
